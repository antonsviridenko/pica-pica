Protocol Specification.

Terminology.

Client - software instance that interacts with human users and lets them send and
receive encrypted messages over Pica Pica.

Node - software instance that coordinates Pica Pica network, maintains list of
all active nodes and provides connectivity to clients.

Connections.
There are 4 types of connections between Pica Pica nodes and clients.

-client to node (c2n) - control connection from client to node

-client to client (c2c) - data connection between clients through node acting
as a proxy

-node to node (n2n) - control & data connection between nodes

-direct client to client (directc2c) - direct connection between clients,
using IPv4/IPv6/DNS 
address of accepting client previously communicated through c2c connection.

These connections use TCP transport. First 3 connection types start
with TLS 1.2 handshake using anonymous Diffie-Hellman ciphersuite,
connecting host acts as a TLS client, accepting host is TLS server.
After connection type is identified by accepting node, anonymous TLS
session is gracefully closed in case of c2n and c2c connections. Node starts
new TLS session with client in case of c2n, where node acts as a TLS client and
client acts as a TLS server, using client's RSA certificate. In case of
c2c connection node acts as a transparent proxy, sending chunks of data
received from the first client to the second one and vise versa. Clients
establish mutually authenticated TLS session over proxied connection, 
initiator client is a TLS client, accepting client has TLS server role.
n2n connection continues to operate in ADH TLS session, as by design nodes
do not store state that identifies them except network address.


Packet Format.

Pica Pica protocol message packet contains header and tail.

[Header][Tail]

Header is a 2 octet sequence that identifies packet. First and second octets
are always equal to each other.
Tail is a remaining part of the packet. Can be empty. Tail can have fixed
predefined length or in case of variable length packet it begins with 1 or 2
octet sequence that contains unsigned integer number which defines length in 
octets of remaining part of the tail not including lenght octets. Length field
is stored in little-endian format, least significant octet first.

Example:

0x55 0x55 0x03 0x00 0xAA 0xBB 0xCC
[0x55 0x55] - header
[0x03 0x00] - tail length, 2 octets
[0xAA 0xBB 0xCC] payload, 3 octets

